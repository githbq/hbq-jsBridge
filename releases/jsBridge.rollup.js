!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).jsBridge=t()}(this,function(){"use strict";var u=function(){return(u=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function e(n,i){var r,s,o,e,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||o[0]<t[1]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=i.call(n,a)}catch(e){t=[6,e],s=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}return function(){function t(e){if(this.jsBridgePrefix="hbqJsBridge",this.nativeReceiveEventName="hbqNativeReceiveEvent",this.callbacks={},this.events={},this.jsEngine="webkit",this.id=0,!(this instanceof t))return new t(e);window[this.jsBridgePrefix+"Receive"]=this.receive}return t.prototype.invoke=function(n,i,r){return s=this,c=function(){var t;return e(this,function(e){switch(e.label){case 0:return(t=window[this.jsEngine].messageHandlers[n])?[4,t.postMessage(u({},i,{callbackId:++this.id}))]:[2,this];case 1:return e.sent(),r&&(this.callbacks[this.id]=r),[2,this]}})},new((a=o=void 0)||(a=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function i(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,i)}r((c=c.apply(s,o||[])).next())});var s,o,a,c},t.prototype.receive=function(e){var t=e.eventName,n=e.callbackId,i=e.responseId,r=e.data;if(n)this.callbacks[n]&&this.callbacks[n]();else if(t){var s=this.emit(t,r);this.invoke(this.nativeReceiveEventName,{result:s,responseId:i})}},t.prototype.emit=function(e,n){if(!this.events[e])return this;var i={};return this.events[e].forEach(function(e){var t=e(n);Object.assign(i,t)}),i},t.prototype.on=function(e,t){if(e&&t)return this.events[e]=this.events[e]||[],this.events[e].push(t),this},t.prototype.off=function(t,n){var i=this;if(!t||!this.events[t])return this;if(!n)return delete this.events[t],this;var r=[];return this.events[t].forEach(function(e){i.events[t]!==n&&r.push(e)}),this.events[t]=r,this},t}()});
